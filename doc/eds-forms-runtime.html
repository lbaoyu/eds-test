<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EDS Pattern Reference - Universal Editor Forms Runtime</title>
<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  line-height: 1.6;
  color: #222;
  margin: 40px;
  max-width: 900px;
}
h1, h2, h3 {
  color: #1473e6;
}
pre, code {
  background-color: #f8f8f8;
  padding: 6px 10px;
  border-radius: 4px;
  display: block;
  white-space: pre-wrap;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px 12px;
  text-align: left;
  vertical-align: top;
}
th {
  background-color: #eef3f8;
}
a {
  color: #1473e6;
  text-decoration: none;
}
ul {
  margin-left: 20px;
}
</style>
</head>
<body>

<h1>EDS Pattern Reference</h1>
<h2>Universal Editor‚ÄìAuthored Forms with Shared Runtime</h2>

<h3>1Ô∏è‚É£ Architecture Overview</h3>
<p><strong>Goal:</strong> Provide a reusable, EDS‚Äënative forms layer that works with <strong>Universal Editor</strong> and does <em>not</em> depend on AEM Forms or Adaptive Forms Core Components.</p>

<h4>Key Concepts</h4>
<ul>
  <li><strong>Form block:</strong> a single UE‚Äëvisible block used to place forms on pages.</li>
  <li><strong>Shared runtime:</strong> one JS/CSS implementation that renders all forms based on a JSON schema.</li>
  <li><strong>Field renderers:</strong> small, reusable functions that act as your ‚Äúcore components‚Äù for each field type.</li>
</ul>

<h4>Block Structure</h4>
<pre><code>blocks/form/
  form.js          // UE block controller: reads config, loads schema, renders form
  form.css         // shared design system / theme for all forms
  runtime/
    fields.js      // field renderers (your "components")
    validation.js  // shared validation logic
    rules.js       // shared visibility/enablement rules
    submission.js  // shared submit handling
</code></pre>

<h3>Highlights ‚Äî Part 1: Architecture</h3>
<table>
<thead>
<tr><th>Goal</th><th>Key Element</th><th>Description</th></tr>
</thead>
<tbody>
<tr>
  <td>Centralize form behavior</td>
  <td><code>blocks/form/runtime/*.js</code></td>
  <td>One runtime that all forms use for validation, rules, and submission.</td>
</tr>
<tr>
  <td>Reuse field types</td>
  <td><code>fields.js</code></td>
  <td>Implements a small set of field renderers (text, select, checkbox, etc.) as your reusable components.</td>
</tr>
<tr>
  <td>Keep styling consistent</td>
  <td><code>form.css</code></td>
  <td>Single theme file using tokens/BEM to ensure forms look the same everywhere.</td>
</tr>
<tr>
  <td>Integrate with UE</td>
  <td><code>form.js</code></td>
  <td>Reads UE-authored block config, then delegates to the runtime to render the form.</td>
</tr>
</tbody>
</table>

<hr>

<h3>2Ô∏è‚É£ Authoring Model with Universal Editor</h3>
<p><strong>Purpose:</strong> Let authors use Universal Editor to place and configure forms, while keeping schema and behavior in code.</p>

<h4>Form Block Configuration (UE)</h4>
<p>Universal Editor exposes a <strong>Form</strong> block with a small set of editable properties, e.g.:</p>

<ul>
  <li><code>formId</code> ‚Äì which JSON definition to use (e.g. <code>contact-us</code>).</li>
  <li><code>titleOverride</code> ‚Äì optional custom title for this placement.</li>
  <li><code>themeVariant</code> ‚Äì e.g. <code>default</code>, <code>compact</code>.</li>
</ul>

<h4>Example: Block Properties to JSON Schema</h4>
<p>Form definitions live in Git as JSON and are referenced by id:</p>

<pre><code>// /forms/contact-us.json
{
  "id": "contact-us",
  "title": "Contact Us",
  "endpoint": "/api/forms/contact",
  "fields": [
    { "id": "fullName", "type": "text", "label": "Full name", "required": true },
    { "id": "email", "type": "email", "label": "Email", "required": true, "validation": "email" },
    { "id": "message", "type": "textarea", "label": "Message", "required": true },
    { "id": "submit", "type": "submit", "label": "Send" }
  ]
}
</code></pre>

<p>The UE Form block only stores something like <code>formId=&quot;contact-us&quot;</code>; <code>form.js</code> uses that to fetch the schema.</p>

<h3>Highlights ‚Äî Part 2: UE Authoring</h3>
<table>
<thead>
<tr><th>Goal</th><th>Key Idea</th><th>Description</th></tr>
</thead>
<tbody>
<tr>
  <td>Editor-friendly</td>
  <td>Block properties in UE</td>
  <td>Authors configure which form to show and optional variants via UE side panel.</td>
</tr>
<tr>
  <td>Version control</td>
  <td><code>/forms/*.json</code></td>
  <td>Form schema lives in Git, so changes are reviewable and consistent across environments.</td>
</tr>
<tr>
  <td>Loose coupling</td>
  <td>Reference by <code>formId</code></td>
  <td>UE doesn‚Äôt store full form structure; it only points to the schema.</td>
</tr>
</tbody>
</table>

<hr>

<h3>3Ô∏è‚É£ Field Renderers as Reusable ‚ÄúComponents‚Äù</h3>
<p><strong>Purpose:</strong> Implement your own small ‚Äúcore component library‚Äù for forms using plain DOM APIs.</p>

<h4>File: <code>/blocks/form/runtime/fields.js</code></h4>
<pre><code>export function renderTextField(field) {
  const wrapper = document.createElement('div');
  wrapper.className = `form-field form-field--text form-field--${field.id}`;

  const label = document.createElement('label');
  label.className = 'form-field__label';
  label.setAttribute('for', field.id);
  label.textContent = field.label + (field.required ? ' *' : '');

  const input = document.createElement('input');
  input.id = field.id;
  input.name = field.id;
  input.type = field.type === 'email' ? 'email' : 'text';
  input.className = 'form-field__control';
  if (field.placeholder) input.placeholder = field.placeholder;
  if (field.required) input.required = true;

  wrapper.append(label, input);
  return wrapper;
}

export function renderTextarea(field) {
  const wrapper = document.createElement('div');
  wrapper.className = `form-field form-field--textarea form-field--${field.id}`;

  const label = document.createElement('label');
  label.className = 'form-field__label';
  label.setAttribute('for', field.id);
  label.textContent = field.label + (field.required ? ' *' : '');

  const textarea = document.createElement('textarea');
  textarea.id = field.id;
  textarea.name = field.id;
  textarea.className = 'form-field__control';
  if (field.placeholder) textarea.placeholder = field.placeholder;
  if (field.required) textarea.required = true;

  wrapper.append(label, textarea);
  return wrapper;
}

// ...other field renderers: select, checkbox-group, radio-group, date, file, button...

export function renderField(field) {
  switch (field.type) {
    case 'text':
    case 'email':
      return renderTextField(field);
    case 'textarea':
      return renderTextarea(field);
    // add select, checkbox-group, radio-group, date, file, submit, reset...
    default:
      console.warn('Unknown field type', field.type);
      return document.createComment(`Unknown field type: ${field.type}`);
  }
}
</code></pre>

<h4>File: <code>/blocks/form/form.js</code></h4>
<pre><code>import { renderField } from './runtime/fields.js';
import { attachValidation } from './runtime/validation.js';
import { attachRules } from './runtime/rules.js';
import { attachSubmissionHandler } from './runtime/submission.js';

async function loadDefinition(formId) {
  const res = await fetch(`/forms/${formId}.json`);
  if (!res.ok) throw new Error(`Form definition not found: ${formId}`);
  return res.json();
}

export default async function decorate(block) {
  // Read config from UE-authored attributes or markup
  const formId = block.dataset.formId || 'contact-us';

  const def = await loadDefinition(formId);
  const form = document.createElement('form');
  form.className = 'eds-form';

  def.fields.forEach((field) =&gt; {
    const node = renderField(field);
    form.appendChild(node);
  });

  attachValidation(form, def);
  attachRules(form, def);
  attachSubmissionHandler(form, def);

  block.textContent = '';
  block.appendChild(form);
}
</code></pre>

<h3>Highlights ‚Äî Part 3: Field Runtime</h3>
<table>
<thead>
<tr><th>Goal</th><th>Key Line of Code</th><th>Description</th></tr>
</thead>
<tbody>
<tr>
  <td>Map schema ‚Üí UI</td>
  <td><code>def.fields.forEach((field) =&gt; renderField(field))</code></td>
  <td>Renders each field using a centralized dispatcher.</td>
</tr>
<tr>
  <td>Reuse across all forms</td>
  <td><code>renderTextField(field)</code></td>
  <td>Encapsulates markup &amp; behavior for a field type in one place.</td>
</tr>
<tr>
  <td>Keep logic modular</td>
  <td><code>attachValidation(form, def)</code></td>
  <td>Allows pluggable validation rules independent of rendering.</td>
</tr>
<tr>
  <td>UE integration</td>
  <td><code>const formId = block.dataset.formId</code></td>
  <td>Reads universal-editor-authored configuration to choose the form.</td>
</tr>
</tbody>
</table>

<hr>

<h3>4Ô∏è‚É£ Styling &amp; Design System</h3>
<p><strong>Purpose:</strong> Provide a consistent look and feel for all forms with a single stylesheet.</p>

<h4>File: <code>/blocks/form/form.css</code></h4>
<pre><code>:root {
  --form-font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  --form-color-bg: #ffffff;
  --form-color-border: #c5c5c5;
  --form-color-border-focus: #2680eb;
  --form-color-error: #d7373f;
  --form-radius: 4px;
  --form-spacing: 0.75rem;
}

.eds-form {
  font-family: var(--form-font-family);
  background: var(--form-color-bg);
}

/* Field wrapper */
.form-field {
  margin-bottom: var(--form-spacing);
}

.form-field__label {
  display: block;
  font-size: 0.875rem;
  margin-bottom: 0.25rem;
}

/* Controls */
.form-field__control {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border-radius: var(--form-radius);
  border: 1px solid var(--form-color-border);
  font-size: 1rem;
  box-sizing: border-box;
}

.form-field__control:focus {
  outline: none;
  border-color: var(--form-color-border-focus);
  box-shadow: 0 0 0 1px var(--form-color-border-focus);
}

/* Error state */
.form-field--error .form-field__control {
  border-color: var(--form-color-error);
}

.form-field__error-message {
  color: var(--form-color-error);
  font-size: 0.75rem;
  margin-top: 0.25rem;
}
</code></pre>

<h3>Highlights ‚Äî Part 4: Styling</h3>
<table>
<thead>
<tr><th>Goal</th><th>Key Line of Code</th><th>Description</th></tr>
</thead>
<tbody>
<tr>
  <td>Theme via tokens</td>
  <td><code>:root { --form-color-border: #c5c5c5; }</code></td>
  <td>Centralizes colors/spacing so theme changes are easy.</td>
</tr>
<tr>
  <td>Consistent structure</td>
  <td><code>.form-field__label</code>, <code>.form-field__control</code></td>
  <td>Applies the same structure across all field types.</td>
</tr>
<tr>
  <td>Error handling</td>
  <td><code>.form-field--error .form-field__control</code></td>
  <td>Highlights invalid fields in a unified way.</td>
</tr>
<tr>
  <td>Extendable variants</td>
  <td><code>.eds-form--compact</code> (optional)</td>
  <td>Supports design variants driven by UE block properties.</td>
</tr>
</tbody>
</table>

<hr>

<h3>5Ô∏è‚É£ Summary</h3>
<ul>
  <li><strong>No AEM Forms dependency:</strong> everything is static assets (JSON + JS + CSS) compatible with Edge Delivery Services.</li>
  <li><strong>Universal Editor friendly:</strong> authors place and configure a single Form block; all heavy lifting is in your runtime.</li>
  <li><strong>Reusable ‚Äúcomponents‚Äù:</strong> each field type is a small renderer function, similar in spirit to AEM Core Components but implemented client-side.</li>
  <li><strong>Single design system:</strong> <code>form.css</code> defines typography, spacing, borders, and error styles for all forms.</li>
  <li><strong>Maintainable &amp; extensible:</strong> changes to renderers or validation apply across every form instance automatically.</li>
</ul>

<p>üîó Reference for EDS/blocks:<br>
<a href="https://experienceleague.adobe.com/en/docs/experience-manager-cloud-service/content/edge-delivery/build-forms/overview" target="_blank">
Edge Delivery Services for AEM Forms ‚Äì Overview
</a></p>

</body>
</html>
